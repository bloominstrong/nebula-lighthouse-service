<!DOCTYPE html><html><head><meta charset="utf-8"><title>Public Nebula VPN Lighthouse Server</title><style></style></head><body id="preview">
<h1 class="code-line" data-line-start=0 data-line-end=1><a id="Public_Nebula_VPN_Lighthouse_Server_0"></a>Public Nebula VPN Lighthouse Server</h1>
<h2 class="code-line" data-line-start=2 data-line-end=3><a id="Introduction_2"></a>Introduction</h2>
<p class="has-line-data" data-line-start="3" data-line-end="4">This server is a public <a href="https://www.defined.net/nebula/">Nebula VPN</a> Lighthouse Service. You can use it in case you don’t have a publicly accessible server to run your own Nebula Lighthouse.</p>
<h2 class="code-line" data-line-start=5 data-line-end=6><a id="List_of_Public_Nebula_Lighthouse_Services_5"></a>List of Public Nebula Lighthouse Services</h2>
<p class="has-line-data" data-line-start="6" data-line-end="7">See <a href="https://htmlpreview.github.io/?https://github.com/manuels/nebula-lighthouse-service/blob/main/server-list.html">the project’s server list</a> to get a list of public servers.</p>
<h2 class="code-line" data-line-start=8 data-line-end=9><a id="What_is_a_Nebula_Lighthouse_8"></a>What is a Nebula Lighthouse?</h2>
<p class="has-line-data" data-line-start="10" data-line-end="11">In Nebula, a lighthouse is a Nebula host that is responsible for keeping track of all the other Nebula hosts, and helping them find each other within a Nebula network.</p>
<h2 class="code-line" data-line-start=12 data-line-end=13><a id="Quickstart_12"></a>Quickstart</h2>
<p class="has-line-data" data-line-start="14" data-line-end="15">Follow the steps in Nebula’s <a href="https://www.defined.net/nebula/quick-start/">Quick Start tutorial</a>.</p>
<blockquote>
<p class="has-line-data" data-line-start="16" data-line-end="17"><strong>Security advice:</strong> When you sign the host keys of your devices (e.g. via <code>nebula-cert sign -groups my_network</code>), add all your devices to one group (here <code>my_network</code>) to be able to block out the Lighthouse service from the rest of your network. (See section Blocking out the Lighthouse from your network).</p>
</blockquote>
<p class="has-line-data" data-line-start="18" data-line-end="19">If you follow this tutorial, you will create three files:</p>
<ul>
<li class="has-line-data" data-line-start="20" data-line-end="21"><code>ca.crt</code></li>
<li class="has-line-data" data-line-start="21" data-line-end="22"><code>lighthouse1.crt</code></li>
<li class="has-line-data" data-line-start="22" data-line-end="24"><code>lighthouse1.key</code></li>
</ul>
<p class="has-line-data" data-line-start="24" data-line-end="26">Now send a POST request with these three files as parameters to a server (choose <a href="https://htmlpreview.github.io/?https://github.com/manuels/nebula-lighthouse-service/blob/main/server-list.html">one of the servers of this list</a>).<br>
Here is an example of how to do it with curl:</p>
<pre><code class="has-line-data" data-line-start="28" data-line-end="32">$ curl -X POST &quot;http://${public_lighthouse}/lighthouse/&quot; -F <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="3053516f5342440d701e">[email&#160;protected]</a>/ca.crt -F <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="81e9eef2f5dee2f3f5bcc1af">[email&#160;protected]</a>/lighthouse1.crt -F <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="9cf4f3efe8c3f7f9e5a1dcb2">[email&#160;protected]</a>/lighthouse1.key
{'port': 49153}
#        ^^^^^ this port will differ for your request
</code></pre>
<p class="has-line-data" data-line-start="33" data-line-end="35">(It is not harmful to run this command several times - it is idempotent.)<br>
Now add this information to your clients’ Nebula configuration file using a section like this one:</p>
<pre><code class="has-line-data" data-line-start="37" data-line-end="40">static_host_map:
    &quot;192.168.100.1&quot;: [&quot;${public_lighthouse}:49153&quot;]
</code></pre>
<p class="has-line-data" data-line-start="41" data-line-end="43">The server returns a JSON-encoded response that contains a port that you can now use as your VPN’s Nebula lighthouse.<br>
You can check the status of this service using</p>
<pre><code class="has-line-data" data-line-start="45" data-line-end="48">$ curl -X GET &quot;http://${public_lighthouse}/lighthouse/&quot; -F <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="177476487465632a5739">[email&#160;protected]</a>/ca.crt -F host_c<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="3b494f067b15">[email&#160;protected]</a>/lighthouse1.crt -F <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="3951564a4d66525c40047917">[email&#160;protected]</a>/lighthouse1.key
{'running': true, 'port': 49153}
</code></pre>
<blockquote>
<p class="has-line-data" data-line-start="49" data-line-end="50"><strong>Security advice:</strong> See the next section to ensure that the lighthouse service cannot access other devices in your VPN.</p>
</blockquote>
<h2 class="code-line" data-line-start=51 data-line-end=52><a id="Blocking_out_the_Lighthouse_from_your_Network_51"></a>Blocking out the Lighthouse from your Network</h2>
<p class="has-line-data" data-line-start="53" data-line-end="54">The lighthouse should not have access to your network, so when signing your host keys you should add all devices (excluding the lighthouse) to one group (here <code>my_network</code>), e.g.</p>
<pre><code class="has-line-data" data-line-start="56" data-line-end="59">nebula-cert sign -name &quot;laptop&quot; -ip &quot;192.168.100.5/24&quot; -groups &quot;laptop,my_network&quot;
#                                                                      ^^^^^^^^^^ This is important
</code></pre>
<p class="has-line-data" data-line-start="60" data-line-end="61">When you add firewall rules to your Nebula config, always make sure to exclude the lighthouse service like this:</p>
<pre><code class="has-line-data" data-line-start="63" data-line-end="76">firewall:
  outbound:
    # Allow all outbound traffic from this node but to the lighthouse
    - port: any
      proto: any
      group: my_network  # &lt;-- this blocks out the nebula lighthouse
      
  inbound:
    # Allow tcp/443 from any host but the lighthouse
    - port: 443
      proto: tcp
      group: my_network  # &lt;-- this blocks out the nebula lighthouse
</code></pre>
<h2 class="code-line" data-line-start=77 data-line-end=78><a id="How_to_run_a_public_Lighthouse_service_77"></a>How to run a public Lighthouse service?</h2>
<p class="has-line-data" data-line-start="78" data-line-end="79">The public Nebula Lighthouse service is distributed <a href="https://snapcraft.io/nebula-lighthouse-service">via snap</a>. Snap allows for Nebula Lighthouse services to run in a strict confinement.</p>
<p class="has-line-data" data-line-start="80" data-line-end="81">Install the service:</p>
<pre><code class="has-line-data" data-line-start="82" data-line-end="84">$ sudo snap install nebula-lighthouse-service
</code></pre>
<p class="has-line-data" data-line-start="84" data-line-end="85">Set public webserver port:</p>
<pre><code class="has-line-data" data-line-start="86" data-line-end="88">$ sudo snap set nebula-lighthouse-service webserver.port=80
</code></pre>
<p class="has-line-data" data-line-start="89" data-line-end="90">Set available port range for lighthouses (according to private port range in <a href="https://datatracker.ietf.org/doc/html/rfc6335#section-6">RFC 6335</a>):</p>
<pre><code class="has-line-data" data-line-start="91" data-line-end="94">$ sudo snap set nebula-lighthouse-service min-port=49152
$ sudo snap set nebula-lighthouse-service max-port=65535
</code></pre>
<p class="has-line-data" data-line-start="95" data-line-end="96">You can add your server to the <a href="https://github.com/manuels/nebula-lighthouse-service/blob/main/server-list.html">list of public Nebula lighthouse services</a> on Github.</p>
<h2 class="code-line" data-line-start=97 data-line-end=98><a id="Debugging_the_Service_97"></a>Debugging the Service</h2>
<p class="has-line-data" data-line-start="98" data-line-end="99">When you run a Nebula Lighthouse service, there is systemd service with the name <code>snap.nebula-lighthouse-service.webservice</code> running and for each served lighthouse a service with the name <code>snap.nebula-lighthouse-service.lighthouse-$i</code> (where <code>i</code> is an increasing number starting with <code>0</code>).</p>
<p class="has-line-data" data-line-start="100" data-line-end="101">You can check if the services are running using</p>
<pre><code class="has-line-data" data-line-start="102" data-line-end="105">$ sudo systemctl status snap.nebula-lighthouse-service.webservice
$ sudo systemctl status snap.nebula-lighthouse-service.lighthouse-0
</code></pre>
<p class="has-line-data" data-line-start="105" data-line-end="106">or check the complete logs using</p>
<pre><code class="has-line-data" data-line-start="107" data-line-end="110">sudo journalctl -u snap.nebula-lighthouse-service.webservice
sudo journalctl -u snap.nebula-lighthouse-service.lighthouse-0
</code></pre>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script></body></html>